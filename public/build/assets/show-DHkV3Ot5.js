import{r as j,j as e,b as J,t as g,u as re,a as G,L as ne,H as F}from"./app-DcC59gM4.js";import{X as V,e as Ce,f as De,g as Le,h as Te,A as B}from"./app-layout-md0N9P8I.js";import{P as U}from"./page-header-C_7k5sLc.js";import{T as Pe,a as Me,b as O,c as $}from"./tabs-CrIDjGd0.js";import{c as Q,B as N}from"./button-CpjRaYVo.js";import{B as C}from"./badge-CyCmFY9U.js";import{C as k,a as y,e as w,c as P,b as _}from"./card-B1wzXt6A.js";import{I as q}from"./input-B_FIGcdk.js";import{T as Re,a as Ee,b as ie,c as D,d as Ie,e as L}from"./table-BJorX1cb.js";import{f as Z,b as le}from"./date-DGrPaBmu.js";import{g as Ae}from"./file-TGdxFJ4x.js";import{F as A,U as Fe}from"./users-DLXe7dN4.js";import{M as E}from"./map-pin-BhVwCCAx.js";import{C as Be}from"./calendar-days-CweVvMYD.js";import{S as ee}from"./search-CFhtlakL.js";import{C as ae}from"./check-CoDZEjDS.js";import{E as W}from"./eye-B5TCxU7g.js";import{T as Ue,D as Oe}from"./table-actions-DxeP1VWF.js";import{C as $e}from"./calendar-CvU2iXXj.js";import{C as X}from"./camera-DuenHVQT.js";import{L as T}from"./label-DnZ7SDYy.js";import{S as ze,a as He,b as Ke,c as Ge,e as z}from"./select-yq4R6Uel.js";import{F as se}from"./file-upload-EsrYl4hi.js";import{C as Ve}from"./checkbox-DRfxPaNd.js";import{I as M}from"./input-error-C6nxwA3J.js";import{C as qe}from"./circle-check-big-lT-oNzny.js";import{A as We}from"./arrow-left-BYYp_exB.js";/* empty css            */import"./index-CcsY0bVV.js";import"./index-CAOgDV9q.js";import"./format-Ca1hgyLe.js";import"./alert-dialog-CAdiPnCD.js";import"./index-D8OKb2YG.js";import"./chevron-down-JOi0Hr8o.js";import"./input-error-CwjUQo6T.js";import"./upload-XjPs63n1.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]],Qe=Q("CameraOff",Je);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3",key:"1i73f7"}],["path",{d:"M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3",key:"saxlbk"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 2v2",key:"tus03m"}]],Ye=Q("FlipHorizontal",Xe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ea=Q("Info",Ze),aa=a=>{switch(a){case"approved":return"default";case"submitted":return"secondary";case"rejected":return"destructive";case"draft":default:return"secondary"}},sa=a=>{switch(a){case"approved":return"bg-green-100 text-green-800";case"submitted":return"bg-blue-100 text-blue-800";case"rejected":return"bg-red-100 text-red-800";case"draft":default:return""}},ta=a=>{switch(a){case"approved":return"Approved";case"submitted":return"Submiited";case"rejected":return"Rejected";case"draft":return"Draft";default:return"Draft"}},H=a=>a.travel_type==="in_city"?!!a.in_city_report:a.travel_type==="out_city"?!!a.out_city_report:a.travel_type==="out_country"?!!a.out_country_report:!1,ra=a=>a.travel_type==="in_city"?"Dalam Kota":a.travel_type==="out_city"?"Luar Kota":a.travel_type==="out_country"?"Luar Negeri":"N/A",na=a=>a&&a.travel_report?"ada":"belum",ia=(a,n,t)=>{if(!n||n.status==="draft")return!1;if(a.id===t.user.id)return!0;const o=t.user.roles??[];return!!(o.some(s=>typeof s=="string"?s==="leader":s.name==="leader")&&a.workUnit?.head?.id===t.user.id||o.some(s=>{const c=typeof s=="string"?s:s.name;return["superadmin","admin","verificator"].includes(c)}))};function la({user:a,index:n,assignment:t,auth:o}){const r=t.reports?.find(c=>c.user_id===a.id),i=!!r,s=a.workUnit?.name||"Unit Kerja tidak tersedia";return e.jsxs(ie,{children:[e.jsx(L,{className:"font-medium",children:n+1}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Ce,{className:"h-8 w-8",children:[e.jsx(De,{src:Ae(a.photo)||void 0,alt:a.name}),e.jsx(Le,{className:"text-xs font-medium",children:Te(a.name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.email||"Email tidak tersedia"})]})]})}),e.jsx(L,{children:s}),e.jsx(L,{children:r?e.jsxs(C,{variant:H(r)?"default":"secondary",className:H(r)?"bg-green-100 text-green-800":"",children:[H(r)?e.jsx(ae,{className:"h-3 w-3"}):e.jsx(V,{className:"h-3 w-3"}),ra(r)]}):e.jsx(C,{variant:"outline",children:"-"})}),e.jsx(L,{children:r?na(r)==="ada"?e.jsxs(C,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(ae,{className:"h-3 w-3"}),"Ada"]}):e.jsxs(C,{variant:"secondary",children:[e.jsx(V,{className:"h-3 w-3"}),"Belum"]}):e.jsx(C,{variant:"outline",children:"-"})}),e.jsx(L,{children:i?e.jsxs(C,{variant:aa(r.status),className:sa(r.status),children:[e.jsx(A,{className:"h-3 w-3"}),ta(r.status)]}):e.jsx(C,{variant:"secondary",children:"Belum Lapor"})}),e.jsx(L,{className:"text-center",children:i&&ia(a,r,o)?r.status==="draft"?e.jsxs(N,{variant:"outline",size:"sm",disabled:!0,className:"cursor-not-allowed opacity-50",children:[e.jsx(W,{className:"h-4 w-4"}),"Draft"]}):e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>J.get(route("reports.show",r.id)),children:[e.jsx(W,{className:"h-4 w-4"}),"Lihat"]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})})]},a.id)}function te({assignment:a,auth:n}){const[t,o]=j.useState(""),r=j.useMemo(()=>{const i=a.users??[],s=t.trim().toLowerCase();return s?i.filter(c=>c.name.toLowerCase().includes(s)):i},[a.users,t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Informasi Penugasan"]}),e.jsx(P,{children:"Detail lengkap penugasan perjalanan dinas"})]}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Maksud Perjalanan Dinas"}),e.jsx("p",{className:"mt-1 text-lg break-words whitespace-normal",children:a.purpose})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:a.destination})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:[Z(a.start_date)," - ",Z(a.end_date)]})]})]})]})})]}),e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),"Daftar Peserta"]}),e.jsx(P,{children:"Daftar peserta penugasan perjalanan dinas"})]}),e.jsxs(_,{children:[e.jsxs("div",{className:"relative mb-4 w-full md:w-[280px]",children:[e.jsx(ee,{className:"absolute top-2.5 left-2 h-4 w-4 text-muted-foreground"}),e.jsx(q,{placeholder:"Cari nama...",value:t,onChange:i=>o(i.target.value),className:"w-full pr-8 pl-10"}),t&&e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>o(""),className:"absolute top-0 right-0 h-full px-3 hover:bg-transparent",children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Re,{children:[e.jsx(Ee,{children:e.jsxs(ie,{children:[e.jsx(D,{className:"w-[50px]",children:"No"}),e.jsx(D,{children:"Nama Peserta"}),e.jsx(D,{children:"Unit Kerja"}),e.jsx(D,{children:"Biaya"}),e.jsx(D,{children:"Laporan Perjalanan"}),e.jsx(D,{children:"Status"}),e.jsx(D,{className:"text-center",children:"Aksi"})]})}),e.jsx(Ie,{children:r.map((i,s)=>e.jsx(la,{user:i,index:s,assignment:a,auth:n},i.id))})]})})}),t.trim()&&r.length===0&&e.jsxs("div",{className:"py-4 text-center text-muted-foreground",children:[e.jsx(ee,{className:"mx-auto mb-2 h-6 w-6 opacity-50"}),e.jsxs("p",{className:"text-sm",children:['Tidak ada peserta yang cocok dengan pencarian "',t,'"']})]})]})]})]})}function oa(a,n,t){const o=Math.min(120,n.height*.3),r=n.height-o,i=a.createLinearGradient(0,r,0,n.height);i.addColorStop(0,"rgba(0, 0, 0, 0.3)"),i.addColorStop(1,"rgba(0, 0, 0, 0.8)"),a.fillStyle=i,a.fillRect(0,r,n.width,o),a.fillStyle="white",a.textAlign="left";const s=Math.max(12,Math.min(16,n.width/40)),c=Math.max(10,Math.min(14,n.width/50));a.font=`500 ${s}px system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif`;const h=n.width-40,u=t.address.split(" ");let p="",m=r+s+10;for(let l=0;l<u.length;l++){const f=p+u[l]+" ";a.measureText(f).width>h&&l>0?(a.fillText(p.trim(),20,m),p=u[l]+" ",m+=s+2):p=f}a.fillText(p.trim(),20,m),a.font=`400 ${c}px system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif`,a.fillStyle="rgba(255, 255, 255, 0.9)",a.fillText(`📍 ${t.latitude.toFixed(6)}, ${t.longitude.toFixed(6)}`,20,m+c+10);const d=new Date().toISOString();a.fillText(`📅 ${le(d)}`,20,m+(c+10)*2)}function ca(){const[a,n]=j.useState(!1),[t,o]=j.useState("back"),r=j.useRef(null),i=j.useRef(null),s=j.useRef(null),c=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),h=j.useCallback(async()=>{try{n(!0);const d=await navigator.mediaDevices.getUserMedia({video:{facingMode:t==="back"?"environment":"user",width:{ideal:1920},height:{ideal:1080}}});s.current=d,r.current&&(r.current.srcObject=d)}catch(d){throw console.error("Error starting camera:",d),n(!1),d}},[t]),u=j.useCallback(()=>{s.current&&(s.current.getTracks().forEach(d=>d.stop()),s.current=null),n(!1)},[]),p=j.useCallback(async()=>{if(!(!a||!c))try{s.current&&(s.current.getTracks().forEach(f=>f.stop()),s.current=null);const d=t==="back"?"front":"back";o(d);const l=await navigator.mediaDevices.getUserMedia({video:{facingMode:d==="back"?"environment":"user",width:{ideal:1920},height:{ideal:1080}}});s.current=l,r.current&&(r.current.srcObject=l)}catch(d){throw console.error("Error flipping camera:",d),o(t),d}},[a,t,c]),m=j.useCallback(async d=>{if(!r.current||!i.current)throw new Error("Kamera tidak siap");return new Promise((l,f)=>{try{const x=r.current,v=i.current,S=v.getContext("2d");if(!S){f(new Error("Tidak dapat mengakses canvas"));return}v.width=x.videoWidth,v.height=x.videoHeight,S.drawImage(x,0,0),d&&oa(S,v,d),v.toBlob(I=>{I?l(I):f(new Error("Tidak dapat mengambil foto"))},"image/jpeg",.8)}catch(x){f(x)}})},[]);return{isCapturing:a,videoRef:r,canvasRef:i,currentCameraMode:t,isMobile:c,startCamera:h,stopCamera:u,capturePhoto:m,flipCamera:p}}function da(){const[a,n]=j.useState(!1);return{isLoading:a,uploadDocumentation:async(o,r,i,s="report")=>{try{n(!0);const c=new FormData;c.append("photo",o,"documentation.jpg"),c.append("address",r.address),c.append("latitude",r.latitude.toString()),c.append("longitude",r.longitude.toString());const h=s==="assignment"?"assignments.documentation.store":"reports.documentation.store";await new Promise((u,p)=>{J.post(route(h,i),c,{preserveScroll:!0,onSuccess:()=>{g.success("Dokumentasi berhasil disimpan"),u()},onError:m=>{console.error("Upload errors:",m);const d=m.photo||m.address||m.latitude||m.longitude||"Gagal mengunggah dokumentasi";g.error(d),p(new Error(d))},onFinish:()=>{n(!1)}})})}catch(c){throw console.error("Error uploading:",c),g.error("Gagal mengunggah dokumentasi"),n(!1),c}}}}const ua=()=>{const[a,n]=j.useState(null),[t,o]=j.useState(null);return{currentLocation:a,locationError:t,getCurrentLocation:()=>new Promise((s,c)=>{if(!navigator.geolocation){c(new Error("Geolocation tidak didukung oleh browser ini"));return}navigator.geolocation.getCurrentPosition(async h=>{const{latitude:u,longitude:p}=h.coords;try{const l=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${u}&lon=${p}&zoom=18&addressdetails=1&accept-language=id`)).json()).display_name||`${u}, ${p}`,f={latitude:u,longitude:p,address:l};n(f),o(null),s(f)}catch{const d={latitude:u,longitude:p,address:`${u}, ${p}`};n(d),o(null),s(d)}},h=>{let u="Tidak dapat mendapatkan lokasi";switch(h.code){case h.PERMISSION_DENIED:u="Izin lokasi ditolak";break;case h.POSITION_UNAVAILABLE:u="Informasi lokasi tidak tersedia";break;case h.TIMEOUT:u="Timeout mendapatkan lokasi";break}o(u),c(new Error(u))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),clearLocation:()=>{n(null),o(null)}}};async function ma(a,n){try{const o=await(await fetch(a)).blob(),r=window.URL.createObjectURL(o),i=document.createElement("a");i.href=r;const c=new Date(n.created_at).toISOString().split("T")[0],h=n.address.split(",")[0].replace(/[^a-zA-Z0-9]/g,"_").substring(0,20),u=`dokumentasi_${c}_${h}.jpg`;i.download=u,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r),g.success("Gambar berhasil diunduh")}catch(t){throw console.error("Error downloading image:",t),g.error("Gagal mengunduh gambar"),t}}function ha({videoRef:a,canvasRef:n,isLoading:t,hasLocation:o,isMobile:r,currentLocation:i,onStopCamera:s,onCapturePhoto:c,onFlipCamera:h}){return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"relative w-full",style:{aspectRatio:"16/9"},children:[e.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover rounded-lg border"}),i&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 bg-black/50 text-white rounded-b-lg",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm line-clamp-2 font-medium",children:i.address}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[e.jsx(E,{className:"h-3 w-3"}),e.jsxs("span",{children:[i.latitude.toFixed(6),", ",i.longitude.toFixed(6)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[e.jsx($e,{className:"h-3 w-3"}),e.jsx("span",{children:le(new Date().toISOString())})]})]})})]}),e.jsx("canvas",{ref:n,className:"hidden"}),e.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[e.jsx(N,{variant:"outline",onClick:s,disabled:t,children:"Batal"}),r&&e.jsx(N,{variant:"outline",onClick:h,disabled:t,size:"icon",children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx(N,{onClick:c,disabled:t||!o,children:t?"Menyimpan...":"Ambil Foto"})]})]})})}function pa({onStartCamera:a}){return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"size-10 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-medium text-muted-foreground mb-2",children:"Mulai Dokumentasi"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Klik tombol di bawah untuk mengaktifkan kamera dan GPS"}),e.jsx(N,{onClick:a,className:"w-full sm:w-auto",children:"Mulai Kamera"})]})}function xa({locationError:a,currentLocation:n,isGettingLocation:t}){return a?e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-700 text-sm",children:a}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:"Dokumentasi tetap dapat dibuat tanpa lokasi"})]}):n?e.jsxs("div",{className:"bg-green-300/10 p-4 rounded-lg border border-green-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-green-700 text-sm font-medium",children:"Lokasi Terdeteksi"})]}),e.jsx("p",{className:"text-green-600 text-xs mt-1",children:n.address})]}):t?e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:e.jsx("p",{className:"text-yellow-700 text-sm",children:"Mendapatkan lokasi..."})}):null}function fa({documentations:a,assignment:n,onShowLocation:t,onDownload:o,onDelete:r}){if(a.length===0)return e.jsxs(k,{className:"h-min",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Dokumentasi Lokasi"}),e.jsx(P,{children:"Belum ada dokumentasi lokasi yang diambil"})]}),e.jsx(_,{children:e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(E,{className:"mx-auto mb-4 size-10 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mulai ambil foto untuk dokumentasi lokasi. Ambil 2 atau 4 foto agar rapi di laporan perjalanan."})]})})]});const i=n?.reports?.some(s=>s.status==="submitted"||s.status==="approved");return e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsx(w,{children:"Dokumentasi Lokasi"}),e.jsxs(P,{children:[a.length," foto dokumentasi lokasi"]})]}),e.jsx(_,{children:e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsxs(k,{className:"relative overflow-hidden p-0 shadow-none",children:[s.photo?e.jsx("img",{src:s.photo,alt:"Dokumentasi lokasi",className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-muted-foreground",children:e.jsx(E,{className:"h-8 w-8"})}),!i&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Ue,{onShow:()=>t(s),onDownload:()=>o(s),onDelete:()=>r(s),className:"bg-background/90 hover:bg-background"})})]},s.id))})})]})}function ja({assignment:a,documentations:n}){const[t,o]=j.useState(n||[]),[r,i]=j.useState(!1),[s,c]=j.useState(null),[h,u]=j.useState(!1),p=a?.reports?.some(b=>b.status==="submitted"||b.status==="approved"),{currentLocation:m,locationError:d,getCurrentLocation:l,clearLocation:f}=ua(),{isCapturing:x,videoRef:v,canvasRef:S,startCamera:I,stopCamera:oe,capturePhoto:ce,flipCamera:de,isMobile:ue}=ca(),{isLoading:me,uploadDocumentation:he}=da(),{delete:pe,processing:xe}=re(),{props:fe}=G(),R=fe.flash;j.useEffect(()=>{R?.success&&g.success(R.success),R?.error&&g.error(R.error)},[R]),j.useEffect(()=>{o(n||[])},[n]);const je=async()=>{if(p){g.warning("Dokumentasi tidak dapat diakses setelah laporan disubmit/approved.");return}try{u(!0),await l(),await I()}catch(b){console.error("Error starting camera:",b),b instanceof Error&&(b.message.includes("lokasi")||g.error("Tidak dapat mengakses kamera"))}finally{u(!1)}},Y=()=>{oe(),f()},ge=async()=>{if(p){g.warning("Dokumentasi tidak dapat diakses setelah laporan disubmit/approved.");return}if(!m){g.error("Lokasi tidak tersedia");return}try{const b=await ce(m);b&&(await he(b,m,a.id,"assignment"),Y())}catch(b){console.error("Error capturing photo:",b),g.error("Gagal mengambil foto")}},be=async()=>{if(p){g.warning("Dokumentasi tidak dapat diakses setelah laporan disubmit/approved.");return}try{await de()}catch(b){console.error("Error flipping camera:",b),g.error("Tidak dapat membalik kamera")}},ve=b=>{const we=Number(b.latitude),_e=Number(b.longitude),Se=`https://www.google.com/maps?q=${we},${_e}`;window.open(Se,"_blank")},Ne=async b=>{await ma(b.photo,b)},ke=b=>{if(p){g.warning("Dokumentasi tidak dapat dihapus setelah laporan disubmit/approved.");return}c(b),i(!0)},ye=()=>{if(s){if(p){g.warning("Dokumentasi tidak dapat dihapus setelah laporan disubmit/approved."),i(!1),c(null);return}pe(route("assignments.documentation.destroy",[a.id,s.id]),{onBefore:()=>{g.loading("Sedang memproses...")},onSuccess:()=>{i(!1),c(null),g.dismiss()},onError:()=>{i(!1),c(null),g.dismiss()}})}};return e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(Oe,{open:r,onOpenChange:i,onDelete:ye,title:"Hapus dokumentasi?",description:"Tindakan ini tidak dapat dibatalkan. Dokumentasi ini akan dihapus secara permanen dari sistem.",actionLabel:"Hapus",cancelLabel:"Batal",disabled:xe}),e.jsxs(k,{className:"h-min",children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Dokumentasi Lokasi"]}),e.jsx(P,{children:"Ambil foto 2 atau 4 foto dan catat lokasi untuk dokumentasi penugasan perjalanan dinas."})]}),e.jsx(_,{className:"space-y-4",children:p?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 p-4 text-center text-muted-foreground",children:[e.jsx(Qe,{className:"mx-auto mb-4 size-10 text-muted-foreground"}),e.jsx("span",{children:"Dokumentasi tidak dapat diakses setelah laporan disubmit/approved."})]}):x?e.jsxs("div",{className:"space-y-4",children:[e.jsx(xa,{locationError:d,currentLocation:m,isGettingLocation:h}),e.jsx(ha,{videoRef:v,canvasRef:S,isLoading:me,hasLocation:!!m,isMobile:ue,currentLocation:m,onStopCamera:Y,onCapturePhoto:ge,onFlipCamera:be})]}):e.jsx(pa,{onStartCamera:je})})]}),e.jsx(fa,{documentations:t,assignment:a,onShowLocation:ve,onDownload:Ne,onDelete:ke})]})}function ga({assignment:a,transportation_types:n}){const{data:t,setData:o,post:r,processing:i,errors:s}=re({assignment_id:a.id,travel_type:"",actual_duration:"",transportation_type_ids:[],travel_order_number:"",travel_order_file:null,spd_file:null}),c=(l,f)=>{if(f){if(!t.transportation_type_ids.includes(l)){const x=[...t.transportation_type_ids,l];o("transportation_type_ids",x)}}else{const x=t.transportation_type_ids.filter(v=>v!==l);o("transportation_type_ids",x)}},h=l=>{l.preventDefault();const f=new Promise((x,v)=>{r(route("reports.store"),{onSuccess:()=>{x({name:"Laporan"})},onError:S=>{v(S?.error||"Laporan gagal dibuat!")}})});g.promise(f,{loading:"Memproses..",success:x=>`${x.name} berhasil dibuat.`,error:x=>String(x)})},u=(l,f)=>{o(l,f)},p=()=>{o({assignment_id:a.id,travel_type:"",actual_duration:"",transportation_type_ids:[],travel_order_number:"",travel_order_file:null,spd_file:null})},m=a.current_user_report,d=a.current_user_report;return e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:m?e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-green-600"}),"Laporan Sudah Dibuat"]}),e.jsx(P,{children:"Laporan perjalanan dinas untuk penugasan ini sudah dibuat"})]}),e.jsxs(_,{className:"space-y-4",children:[d&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Nomor Surat Tugas:"}),e.jsx("span",{className:"font-medium",children:d.travel_order_number||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Jenis Perjalanan:"}),e.jsx("span",{className:"font-medium",children:d.travel_type==="in_city"?"Dalam Kota":d.travel_type==="out_city"?"Luar Kota":d.travel_type==="out_country"?"Luar Negeri":"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx("span",{className:"font-medium capitalize-first",children:d.status||"Draft"})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(ne,{href:route("reports.show",d?.id),children:e.jsxs(N,{className:"inline-flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Lihat Laporan"]})})})]})]}):e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Form Laporan Perjalanan"]}),e.jsx(P,{children:"Buat laporan pertanggung jawaban perjalanan dinas"})]}),e.jsx(_,{children:e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"travel_type",children:"Tipe Perjalanan"}),e.jsxs(ze,{value:t.travel_type,onValueChange:l=>o("travel_type",l),children:[e.jsx(He,{children:e.jsx(Ke,{placeholder:"Pilih tipe perjalanan"})}),e.jsxs(Ge,{children:[e.jsx(z,{value:"in_city",children:"Dalam Kota"}),e.jsx(z,{value:"out_city",children:"Luar Kota"}),e.jsx(z,{value:"out_country",children:"Luar Negeri"})]})]}),e.jsx(M,{message:s.travel_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"transportation_type_ids",children:"Jenis Transportasi"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:n&&Array.isArray(n)&&n.length>0?n.map(l=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{id:`transportation_${l.id}`,checked:t.transportation_type_ids.includes(l.id),onCheckedChange:f=>c(l.id,f)}),e.jsx(T,{htmlFor:`transportation_${l.id}`,className:"text-sm font-normal cursor-pointer",children:l.label})]},l.id)):e.jsx("div",{className:"col-span-3",children:e.jsx("p",{className:"text-sm text-gray-500",children:n?"Tidak ada jenis transportasi tersedia":"Memuat jenis transportasi..."})})}),e.jsx(M,{message:s.transportation_type_ids}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pilih minimal satu jenis transportasi yang digunakan (wajib)"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"space-y-2 w-full md:w-3/4",children:[e.jsx(T,{htmlFor:"travel_order_number",children:"Nomor Surat Tugas"}),e.jsx(q,{id:"travel_order_number",value:t.travel_order_number,onChange:l=>o("travel_order_number",l.target.value),placeholder:"Masukkan nomor surat tugas"}),e.jsx(M,{message:s.travel_order_number})]}),e.jsxs("div",{className:"space-y-2 w-full md:w-1/4",children:[e.jsx(T,{htmlFor:"actual_duration",children:"Durasi Asli Perjalanan"}),e.jsx(q,{id:"actual_duration",type:"number",min:1,value:t.actual_duration,onChange:l=>o("actual_duration",l.target.value),placeholder:"Durasi asli perjalanan"}),e.jsx(M,{message:s.actual_duration})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"travel_order_file",children:"File Surat Tugas"}),e.jsx(se,{value:t.travel_order_file,onChange:l=>u("travel_order_file",l),accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",maxSize:2,placeholder:"Seret dan letakkan file di sini atau "}),e.jsx(M,{message:s.travel_order_file})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"spd_file",children:"File SPD (Surat Perintah Dinas)"}),e.jsx(se,{value:t.spd_file,onChange:l=>u("spd_file",l),accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",maxSize:2,placeholder:"Seret dan letakkan file di sini atau "}),e.jsx(M,{message:s.spd_file})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(N,{type:"button",variant:"outline",onClick:p,children:"Reset"}),e.jsx(N,{type:"submit",disabled:i,children:i?"Menyimpan...":"Simpan Laporan"})]})]})})]})}),e.jsx("div",{className:"lg:col-span-1",children:m?e.jsxs(k,{children:[e.jsx(y,{children:e.jsx(w,{children:"Status Laporan"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx("p",{children:"Laporan perjalanan dinas sudah dibuat dan siap untuk ditinjau."})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Langkah Selanjutnya:"}),e.jsxs("ul",{className:"space-y-1 text-muted-foreground",children:[e.jsx("li",{children:'• Klik "Lihat Laporan" untuk melihat detail'}),e.jsx("li",{children:"• Laporan akan ditinjau oleh PPK"}),e.jsx("li",{children:"• Setelah disetujui PPK, akan ditinjau Pimpinan"})]})]})]})]}):e.jsxs(k,{children:[e.jsx(y,{children:e.jsx(w,{children:"Informasi"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx("p",{children:"Pastikan semua informasi yang dimasukkan sudah benar dan lengkap."})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("h4",{className:"font-medium mb-2",children:"File yang Diperlukan:"}),e.jsxs("ul",{className:"space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"• Surat Tugas (PDF/DOC)"}),e.jsx("li",{children:"• SPD - Surat Perintah Dinas (PDF/DOC)"})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Ukuran Maksimal:"}),e.jsx("p",{className:"text-muted-foreground",children:"2MB per file"})]})]})]})})]})}const K=[{title:"Dashboard",href:"/dashboard"},{title:"Penugasan",href:"/assignments"},{title:"Rincian",href:""}];function as({assignment:a,transportation_types:n}){const{auth:t}=G().props,[o,r]=j.useState(!1);if(j.useEffect(()=>(r(!0),()=>r(!1)),[]),!a||!t?.user)return e.jsxs(B,{breadcrumbs:K,children:[e.jsx(F,{title:"Rincian Penugasan"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx(U,{title:"Rincian Penugasan",subtitle:"Informasi lengkap penugasan perjalanan dinas"}),e.jsx("div",{className:"p-4 text-center",children:e.jsx("p",{className:"text-destructive",children:"Data tidak tersedia"})})]})]});const i=(t.user.roles??[]).some(x=>x.toLowerCase()==="employee"),s=new Date(a.start_date),h=new Date<s,{props:u}=G(),p=u?.flash?.tabs,[m,d]=j.useState(p||"details"),l=new Set(["documentation","create-report"]),f=x=>{if(o){if(i&&h&&l.has(x)){g.warning("Fitur ini baru bisa diakses saat penugasan sudah dimulai.");return}if(x==="create-report"&&(!a.assignmentDocumentations||a.assignmentDocumentations.length===0)){g.warning("Dokumentasi masih kosong. Silakan tambahkan dokumentasi terlebih dahulu.");return}d(x),J.get(route("assignments.show",a.id),{tabs:x},{preserveState:!0,preserveScroll:!0,replace:!0})}};return o?e.jsxs(B,{breadcrumbs:K,children:[e.jsx(F,{title:"Rincian Penugasan"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx(U,{title:"Rincian Penugasan",subtitle:"Informasi lengkap penugasan perjalanan dinas"}),e.jsx(N,{variant:"outline",asChild:!0,className:"ml-4",children:e.jsxs(ne,{href:route("assignments.index"),children:[e.jsx(We,{className:"h-4 w-4"}),"Kembali"]})})]}),i?e.jsxs(Pe,{value:m,onValueChange:f,className:"w-full",children:[e.jsxs(Me,{className:"grid w-full grid-cols-3",children:[e.jsxs(O,{value:"details",className:"flex items-center gap-2",children:[e.jsx(ea,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:block",children:"Rincian"})]}),e.jsxs(O,{value:"documentation",className:"flex items-center gap-2",disabled:h,title:h?"Dokumentasi bisa diakses saat penugasan sudah dimulai":void 0,children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:block",children:"Dokumentasi"})]}),e.jsxs(O,{value:"create-report",className:"flex items-center gap-2",disabled:h||!a.assignmentDocumentations||a.assignmentDocumentations.length===0,title:h?"Surat Tugas bisa diakses saat penugasan sudah dimulai":!a.assignmentDocumentations||a.assignmentDocumentations.length===0?"Dokumentasi masih kosong":void 0,children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:block",children:"Surat Tugas"})]})]}),e.jsx($,{value:"details",className:"space-y-4",children:e.jsx(te,{assignment:a,auth:t})}),e.jsx($,{value:"documentation",className:"space-y-4",children:e.jsx(ja,{assignment:a,documentations:a.assignmentDocumentations||[]})}),e.jsx($,{value:"create-report",className:"space-y-4",children:e.jsx(ga,{assignment:a,transportation_types:n})})]}):e.jsx("div",{className:"space-y-4",children:e.jsx(te,{assignment:a,auth:t})})]})]}):e.jsxs(B,{breadcrumbs:K,children:[e.jsx(F,{title:"Rincian Penugasan"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx(U,{title:"Rincian Penugasan",subtitle:"Informasi lengkap penugasan perjalanan dinas"}),e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Memuat data..."})]})})]})]})}export{as as default};

import{j as e,b as R,r as p,a as C,t as z,H as L}from"./app-2aN5fFIm.js";import{P as q}from"./page-header-BuPDwsye.js";import{T as B,a as E,b as V,c as U}from"./tabs-DZEB4cJ4.js";import{e as X,f as Q,g as W,h as G,X as $,C as J,A as O}from"./app-layout-DB0FO4Gy.js";import{B as f}from"./button-BItv0zFD.js";import{a as F}from"./date-DGrPaBmu.js";import{g as Y}from"./file-TGdxFJ4x.js";import{F as K}from"./users-DL2eMeY0.js";import{M as Z}from"./map-pin-DV_SSNi0.js";import{C as _}from"./clock-BbcPbpnu.js";import{C as D}from"./circle-check-big-Cd1Kk1aD.js";import{C as A}from"./circle-x-DIR9pVi-.js";import{I as ee}from"./input-UpUYnzU4.js";import{T as ae,a as te,b as M,c as se,d as re,e as H}from"./table-pME_9Ta5.js";import{u as le}from"./navigation-56qOGQYv.js";import{u as ne,f as I,g as oe,a as ie,b as ce,c as de}from"./index-CJTWCbOS.js";import{S as me}from"./search-CANJZ9BR.js";import{C as ue}from"./chevron-left-CxbVlA3U.js";/* empty css            */import"./index-CqrHCE41.js";import"./index--YxB8gKp.js";import"./format-Ca1hgyLe.js";function xe({meta:h,isLeader:g,isVerifikator:t}){return[{id:"no",header:()=>e.jsx("div",{className:"text-center",children:"No"}),cell:({row:s})=>e.jsx("div",{className:"text-center",children:h?h.from+s.index:s.index+1}),enableSorting:!1,enableHiding:!1},{accessorKey:"user",header:"Pegawai",cell:({row:s})=>{const l=s.original.user;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(X,{className:"h-10 w-10",children:[e.jsx(Q,{src:Y(l.photo)||void 0,alt:l.name}),e.jsx(W,{className:"text-sm font-medium",children:G(l.name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:l.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l.workUnit?.name||"-"})]})]})}},{accessorKey:"travel_purpose",header:"Maksud Perjalanan",size:200,cell:({row:s})=>{const r=s.original;return e.jsx("div",{className:"max-w-sm break-words text-wrap",children:e.jsx("p",{className:"text-sm line-clamp-3",children:r.travel_purpose})})}},{accessorKey:"travel_info",header:"Informasi Perjalanan",size:300,cell:({row:s})=>{const r=s.original;return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs font-medium",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),r.travel_order_number]})}),e.jsx("div",{className:"text-xs text-foreground",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),r.destination_city]})}),e.jsx("div",{className:"text-xs text-foreground",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),F(r.departure_date)," - ",F(r.return_date)]})})]})}},{accessorKey:"pimpinan_review",header:()=>e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{children:"Ketua TIM"})}),cell:({row:s})=>{const n=(s.original.reviews||[]).find(i=>i.reviewer_type==="section_head");return n?n.status==="approved"?e.jsx(D,{className:"h-4 w-4 text-green-500"}):e.jsx(A,{className:"h-4 w-4 text-red-500"}):e.jsx(_,{className:"h-4 w-4 text-blue-500"})}},{accessorKey:"ppk_review",header:()=>e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{children:"PPK"})}),cell:({row:s})=>{const n=(s.original.reviews||[]).find(i=>i.reviewer_type==="commitment_officer");return n?n.status==="approved"?e.jsx(D,{className:"h-4 w-4 text-green-500"}):e.jsx(A,{className:"h-4 w-4 text-red-500"}):e.jsx(_,{className:"h-4 w-4 text-blue-500"})}},{id:"actions",header:"Aksi",cell:({row:s})=>{const r=s.original,l=r.status;let n="Lanjutkan",i="default",u="bg-green-600 hover:bg-green-700 text-white hover:text-white";return l==="approved"?(n="Lihat",i="outline",u="border-green-600 text-green-600 hover:bg-green-700 hover:text-white"):l==="rejected"?(n=g||t?"Lihat":"Perbaiki",i="outline",u="border-red-600 text-destructive hover:bg-red-700 hover:text-white"):l==="submitted"&&(n="Lihat",i="outline",u="border-blue-600 text-blue-600 hover:bg-blue-700 hover:text-white"),e.jsx(f,{variant:i,size:"sm",className:u,onClick:()=>R.get(route("reports.show",{report:r.id})),children:n})}}]}function pe({columns:h,data:g,pagination:t,search:s="",status:r}){const{navigateWithQuery:l}=le(),[n,i]=p.useState([]),[u,y]=p.useState([]),[N,k]=p.useState({}),[c,j]=p.useState(s),{props:x}=C(),m=x.flash;p.useEffect(()=>{m?.success&&z.success(m.success),m?.error&&z.error(m.error)},[m]);const v=ne({data:g,columns:h,onSortingChange:i,onColumnFiltersChange:y,getCoreRowModel:de(),getPaginationRowModel:ce(),getSortedRowModel:ie(),getFilteredRowModel:oe(),onColumnVisibilityChange:k,state:{sorting:n,columnFilters:u,columnVisibility:N}}),b=o=>{const a={};o>1&&(a.page=o),c&&(a.search=c);const d=r||C().props.status;d&&d!=="all"&&(a.status=d),l("reports.index",a,{preserveState:!0,replace:!0})},S=p.useCallback(p.useMemo(()=>{let o;return a=>{const d=a.target.value;j(d),clearTimeout(o),o=setTimeout(()=>{const P={};d&&(P.search=d);const T=r||C().props.status;T&&T!=="all"&&(P.status=T),l("reports.index",P,{preserveState:!0,replace:!0})},300)}},[r,l]),[r,l]),w=()=>{j("");const o={},a=r||C().props.status;a&&a!=="all"&&(o.status=a),l("reports.index",o,{preserveState:!0,replace:!0})};return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex flex-wrap w-full gap-2 sm:flex-nowrap",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(me,{className:"absolute top-2.5 left-2 h-4 w-4 text-muted-foreground"}),e.jsx(ee,{placeholder:"Cari nama pegawai/maksud perjalanan...",value:c,onChange:S,className:"w-full pr-8 pl-8 md:w-[400px]"}),c&&e.jsx(f,{variant:"ghost",size:"sm",onClick:w,className:"absolute top-0 right-0 h-full px-3 hover:bg-transparent",children:e.jsx($,{className:"h-4 w-4"})})]})}),c&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-1 bg-secondary text-secondary-foreground px-2 py-1 rounded-md text-sm",children:[e.jsxs("span",{children:["Cari: ",c]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:w,className:"h-4 w-4 p-0 hover:bg-transparent",children:e.jsx($,{className:"h-3 w-3"})})]})})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ae,{children:[e.jsx(te,{children:v.getHeaderGroups().map(o=>e.jsx(M,{children:o.headers.map(a=>e.jsx(se,{className:a.id==="actions"?"w-[100px]":a.id==="no"?"w-[50px]":a.id==="travel_info"?"w-[200px]":a.id==="ppk_review"?"w-[80px] text-center":a.id==="pimpinan_review"?"w-[100px] text-center":void 0,children:a.isPlaceholder?null:I(a.column.columnDef.header,a.getContext())},a.id))},o.id))}),e.jsx(re,{children:v.getRowModel().rows?.length?v.getRowModel().rows.map(o=>e.jsx(M,{children:o.getVisibleCells().map(a=>e.jsx(H,{className:a.column.id==="actions"?"w-[100px]":a.column.id==="no"?"w-[50px]":a.column.id==="travel_info"?"w-[200px]":a.column.id==="ppk_review"?"w-[80px] text-center":a.column.id==="pimpinan_review"?"w-[100px] text-center":void 0,children:I(a.column.columnDef.cell,a.getContext())},a.id))},o.id)):e.jsx(M,{children:e.jsx(H,{colSpan:h.length,className:"h-24 text-center",children:c?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("p",{children:['Tidak ada laporan yang ditemukan untuk pencarian "',c,'"']}),e.jsx(f,{variant:"outline",size:"sm",onClick:w,children:"Hapus pencarian"})]}):"Laporan tidak tersedia."})})})]})}),g.length>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:t?c?`Ditemukan ${t.total} hasil untuk "${c}"`:`Menampilkan ${t.from} - ${t.to} dari ${t.total} hasil`:`Menampilkan ${g.length} hasil`}),t&&t.last_page>1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>b(t.current_page-1),disabled:t.current_page===1,children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[Array.from({length:Math.min(5,t.last_page)},(o,a)=>{const d=a+1;return t.last_page<=5?e.jsx(f,{variant:t.current_page===d?"default":"outline",size:"sm",onClick:()=>b(d),className:"h-8 w-8 p-0",children:d},d):null}),t.last_page>5&&e.jsxs("span",{className:"px-2 text-sm text-muted-foreground",children:["Page ",t.current_page," of ",t.last_page]})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>b(t.current_page+1),disabled:t.current_page===t.last_page,children:e.jsx(J,{className:"h-4 w-4"})})]})]})]})}const he=[{title:"Dashboard",href:"/dashboard"},{title:"Laporan Perjalanan",href:""}];function Ie({reports:h,isAdminOrSuperadmin:g,isLeader:t,isVerifikator:s,status:r,search:l="",totals:n}){const{data:i,meta:u}=h,y=xe({isLeader:t,isVerifikator:s,meta:u});p.useEffect(()=>{(s||t)&&r==="draft"&&R.get(route("reports.index"),{status:"submitted",search:l},{preserveState:!0,replace:!0})},[r,s,t,l]);const N=(s||t)&&r==="draft"?"submitted":r,k=x=>{const m={status:x};l&&(m.search=l),R.get(route("reports.index"),m,{preserveState:!0,replace:!0})},c=()=>g?"Daftar semua laporan pertanggung jawaban perjalanan":s?"Daftar laporan pertanggung jawaban perjalanan yang sudah lengkap":t?"Daftar laporan pertanggung jawaban perjalanan anggota unit kerja Anda yang sudah lengkap":"Daftar semua laporan pertanggung jawaban perjalanan Anda",j=[...s||t?[]:[{value:"draft",icon:K,label:"Draft",count:n.draft,bgColor:"bg-gray-100",textColor:"text-gray-800"}],{value:"submitted",icon:_,label:"Submitted",count:n.submitted,bgColor:"bg-blue-100",textColor:"text-blue-800"},{value:"approved",icon:D,label:"Approved",count:n.approved,bgColor:"bg-green-100",textColor:"text-green-800"},{value:"rejected",icon:A,label:"Rejected",count:n.rejected,bgColor:"bg-red-100",textColor:"text-red-800"}];return e.jsxs(O,{breadcrumbs:he,children:[e.jsx(L,{title:"Laporan Perjalanan"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx(q,{title:"Laporan Perjalanan",subtitle:c()}),e.jsxs(B,{value:N,onValueChange:k,className:"w-full",children:[e.jsx(E,{className:`grid w-full grid-cols-${j.length}`,children:j.map(({value:x,icon:m,label:v,count:b,bgColor:S,textColor:w})=>e.jsxs(V,{value:x,className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:block",children:v}),e.jsx("span",{className:`ml-1 rounded-full px-2 py-0.5 text-xs font-medium ${S} ${w}`,children:b})]},x))}),j.map(({value:x})=>e.jsx(U,{value:x,children:e.jsx(pe,{columns:y,data:i,pagination:u,search:l,status:N})},x))]})]})]})}export{Ie as default};

import{r as j,j as e,b as W,t as N,u as se,a as K,L as te,H as F}from"./app-2aN5fFIm.js";import{X as J,e as _e,f as Se,g as Ce,h as De,A as B}from"./app-layout-DB0FO4Gy.js";import{P as U}from"./page-header-BuPDwsye.js";import{T as Le,a as Te,b as O,c as $}from"./tabs-DZEB4cJ4.js";import{c as re,B as k}from"./button-BItv0zFD.js";import{C as b,a as y,e as w,c as P,b as _}from"./card-CJLns8os.js";import{B as C}from"./badge-eJlqMNco.js";import{T as Pe,a as Me,b as Q,c as D,d as Ee,e as L}from"./table-pME_9Ta5.js";import{f as X,b as ne}from"./date-DGrPaBmu.js";import{g as Ie}from"./file-TGdxFJ4x.js";import{I as G}from"./input-UpUYnzU4.js";import{F as A,U as Re}from"./users-DL2eMeY0.js";import{M as I}from"./map-pin-DV_SSNi0.js";import{C as Ae}from"./calendar-days-DGvgw54E.js";import{S as Y}from"./search-CANJZ9BR.js";import{C as Z}from"./check-DKsR-Bc2.js";import{E as ie}from"./eye-MQgWJon-.js";import{T as Fe,D as Be}from"./delete-dialog-DGccrk8d.js";import{C as q}from"./camera-BJc6FO7u.js";import{C as Ue}from"./calendar-my65S406.js";import{L as T}from"./label-BH8P7zAC.js";import{S as Oe,a as $e,b as He,c as ze,e as H}from"./select-D1oL0Oy2.js";import{F as ee}from"./file-upload-BgPXnGNz.js";import{C as Ke}from"./checkbox-vgXjnkEL.js";import{I as M}from"./input-error-CkgwgHgP.js";import{C as Ge}from"./circle-check-big-Cd1Kk1aD.js";import{A as We}from"./arrow-left-Ded4eBEf.js";/* empty css            */import"./index-CqrHCE41.js";import"./index--YxB8gKp.js";import"./format-Ca1hgyLe.js";import"./alert-dialog-D6zYjwZl.js";import"./index-ClaHt7Hp.js";import"./chevron-down-aBmeQNG4.js";import"./input-error-BSEAQUU0.js";import"./upload-DdAPv1vP.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3",key:"1i73f7"}],["path",{d:"M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3",key:"saxlbk"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 2v2",key:"tus03m"}]],Ve=re("FlipHorizontal",qe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Qe=re("Info",Je);function ae({assignment:a}){const[t,r]=j.useState(""),c=s=>s.travel_type==="in_city"?!!s.in_city_report:s.travel_type==="out_city"?!!s.out_city_report:s.travel_type==="out_country"?!!s.out_country_report:!1,u=s=>s.travel_type==="in_city"?"Dalam Kota":s.travel_type==="out_city"?"Luar Kota":s.travel_type==="out_country"?"Luar Negeri":"N/A",n=j.useMemo(()=>{const s=a.users??[],d=t.trim().toLowerCase();return d?s.filter(l=>l.name.toLowerCase().includes(d)):s},[a.users,t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Informasi Penugasan"]}),e.jsx(P,{children:"Detail lengkap penugasan perjalanan dinas"})]}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Maksud Perjalanan Dinas"}),e.jsx("p",{className:"text-lg mt-1 break-words whitespace-normal",children:a.purpose})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:a.destination})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:[X(a.start_date)," - ",X(a.end_date)]})]})]})]})})]}),e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5"}),"Daftar Peserta"]}),e.jsx(P,{children:"Daftar peserta penugasan perjalanan dinas"})]}),e.jsxs(_,{children:[e.jsxs("div",{className:"relative w-full md:w-[280px] mb-4",children:[e.jsx(Y,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Cari nama...",value:t,onChange:s=>r(s.target.value),className:"pl-10 pr-8 w-full"}),t&&e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>r(""),className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",children:e.jsx(J,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Pe,{children:[e.jsx(Me,{children:e.jsxs(Q,{children:[e.jsx(D,{className:"w-[50px]",children:"No"}),e.jsx(D,{children:"Nama Peserta"}),e.jsx(D,{children:"Unit Kerja"}),e.jsx(D,{children:"Surat Tugas"}),e.jsx(D,{children:"Biaya"}),e.jsx(D,{children:"Status"}),e.jsx(D,{className:"text-center",children:"Aksi"})]})}),e.jsx(Ee,{children:n.map((s,d)=>{const l=a.report&&a.report.user_id===s.id?a.report:void 0,m=!!l,h=s.workUnit?.name??s.work_unit??"Unit Kerja tidak tersedia";return e.jsxs(Q,{children:[e.jsx(L,{className:"font-medium",children:d+1}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(_e,{className:"h-8 w-8",children:[e.jsx(Se,{src:Ie(s.photo)||void 0,alt:s.name}),e.jsx(Ce,{className:"text-xs font-medium",children:De(s.name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email||"Email tidak tersedia"})]})]})}),e.jsx(L,{children:h}),e.jsx(L,{children:l?.has_travel_order?e.jsxs(C,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(Z,{className:"h-3 w-3"}),"Sudah"]}):m?e.jsx(C,{variant:"secondary",children:"Belum"}):e.jsx(C,{variant:"outline",children:"-"})}),e.jsx(L,{children:l?e.jsxs(C,{variant:c(l)?"default":"secondary",className:c(l)?"bg-green-100 text-green-800":"",children:[c(l)?e.jsx(Z,{className:"h-3 w-3"}):e.jsx(J,{className:"h-3 w-3"}),u(l)]}):e.jsx(C,{variant:"outline",children:"-"})}),e.jsx(L,{children:m?e.jsxs(C,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(A,{className:"h-3 w-3"}),"Sudah Lapor"]}):e.jsx(C,{variant:"secondary",children:"Belum Lapor"})}),e.jsx(L,{className:"text-center",children:m?e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>W.get(route("reports.show",l.id)),children:[e.jsx(ie,{className:"h-4 w-4"}),"Lihat"]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},s.id)})})]})})}),t.trim()&&n.length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(Y,{className:"h-6 w-6 mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-sm",children:['Tidak ada peserta yang cocok dengan pencarian "',t,'"']})]})]})]})]})}const Xe=()=>{const[a,t]=j.useState(null),[r,c]=j.useState(null);return{currentLocation:a,locationError:r,getCurrentLocation:()=>new Promise((s,d)=>{if(!navigator.geolocation){d(new Error("Geolocation tidak didukung oleh browser ini"));return}navigator.geolocation.getCurrentPosition(async l=>{const{latitude:m,longitude:h}=l.coords;try{const i=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${m}&lon=${h}&zoom=18&addressdetails=1&accept-language=id`)).json()).display_name||`${m}, ${h}`,p={latitude:m,longitude:h,address:i};t(p),c(null),s(p)}catch{const o={latitude:m,longitude:h,address:`${m}, ${h}`};t(o),c(null),s(o)}},l=>{let m="Tidak dapat mendapatkan lokasi";switch(l.code){case l.PERMISSION_DENIED:m="Izin lokasi ditolak";break;case l.POSITION_UNAVAILABLE:m="Informasi lokasi tidak tersedia";break;case l.TIMEOUT:m="Timeout mendapatkan lokasi";break}c(m),d(new Error(m))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),clearLocation:()=>{t(null),c(null)}}};function Ye(a,t,r){const c=Math.min(120,t.height*.3),u=t.height-c,n=a.createLinearGradient(0,u,0,t.height);n.addColorStop(0,"rgba(0, 0, 0, 0.3)"),n.addColorStop(1,"rgba(0, 0, 0, 0.8)"),a.fillStyle=n,a.fillRect(0,u,t.width,c),a.fillStyle="white",a.textAlign="left";const s=Math.max(12,Math.min(16,t.width/40)),d=Math.max(10,Math.min(14,t.width/50));a.font=`500 ${s}px system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif`;const l=t.width-40,m=r.address.split(" ");let h="",f=u+s+10;for(let i=0;i<m.length;i++){const p=h+m[i]+" ";a.measureText(p).width>l&&i>0?(a.fillText(h.trim(),20,f),h=m[i]+" ",f+=s+2):h=p}a.fillText(h.trim(),20,f),a.font=`400 ${d}px system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif`,a.fillStyle="rgba(255, 255, 255, 0.9)",a.fillText(`ðŸ“ ${r.latitude.toFixed(6)}, ${r.longitude.toFixed(6)}`,20,f+d+10);const o=new Date().toISOString();a.fillText(`ðŸ“… ${ne(o)}`,20,f+(d+10)*2)}function Ze(){const[a,t]=j.useState(!1),[r,c]=j.useState("back"),u=j.useRef(null),n=j.useRef(null),s=j.useRef(null),d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),l=j.useCallback(async()=>{try{t(!0);const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:r==="back"?"environment":"user",width:{ideal:1920},height:{ideal:1080}}});s.current=o,u.current&&(u.current.srcObject=o)}catch(o){throw console.error("Error starting camera:",o),t(!1),o}},[r]),m=j.useCallback(()=>{s.current&&(s.current.getTracks().forEach(o=>o.stop()),s.current=null),t(!1)},[]),h=j.useCallback(async()=>{if(!(!a||!d))try{s.current&&(s.current.getTracks().forEach(p=>p.stop()),s.current=null);const o=r==="back"?"front":"back";c(o);const i=await navigator.mediaDevices.getUserMedia({video:{facingMode:o==="back"?"environment":"user",width:{ideal:1920},height:{ideal:1080}}});s.current=i,u.current&&(u.current.srcObject=i)}catch(o){throw console.error("Error flipping camera:",o),c(r),o}},[a,r,d]),f=j.useCallback(async o=>{if(!u.current||!n.current)throw new Error("Kamera tidak siap");return new Promise((i,p)=>{try{const x=u.current,v=n.current,S=v.getContext("2d");if(!S){p(new Error("Tidak dapat mengakses canvas"));return}v.width=x.videoWidth,v.height=x.videoHeight,S.drawImage(x,0,0),o&&Ye(S,v,o),v.toBlob(R=>{R?i(R):p(new Error("Tidak dapat mengambil foto"))},"image/jpeg",.8)}catch(x){p(x)}})},[]);return{isCapturing:a,videoRef:u,canvasRef:n,currentCameraMode:r,isMobile:d,startCamera:l,stopCamera:m,capturePhoto:f,flipCamera:h}}function ea(){const[a,t]=j.useState(!1);return{isLoading:a,uploadDocumentation:async(c,u,n,s="report")=>{try{t(!0);const d=new FormData;d.append("photo",c,"documentation.jpg"),d.append("address",u.address),d.append("latitude",u.latitude.toString()),d.append("longitude",u.longitude.toString());const l=s==="assignment"?"assignments.documentation.store":"reports.documentation.store";await new Promise((m,h)=>{W.post(route(l,n),d,{preserveScroll:!0,onSuccess:()=>{N.success("Dokumentasi berhasil disimpan"),m()},onError:f=>{console.error("Upload errors:",f);const o=f.photo||f.address||f.latitude||f.longitude||"Gagal mengunggah dokumentasi";N.error(o),h(new Error(o))},onFinish:()=>{t(!1)}})})}catch(d){throw console.error("Error uploading:",d),N.error("Gagal mengunggah dokumentasi"),t(!1),d}}}}async function aa(a,t){try{const c=await(await fetch(a)).blob(),u=window.URL.createObjectURL(c),n=document.createElement("a");n.href=u;const d=new Date(t.created_at).toISOString().split("T")[0],l=t.address.split(",")[0].replace(/[^a-zA-Z0-9]/g,"_").substring(0,20),m=`dokumentasi_${d}_${l}.jpg`;n.download=m,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(u),N.success("Gambar berhasil diunduh")}catch(r){throw console.error("Error downloading image:",r),N.error("Gagal mengunduh gambar"),r}}function sa({locationError:a,currentLocation:t,isGettingLocation:r}){return a?e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-700 text-sm",children:a}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:"Dokumentasi tetap dapat dibuat tanpa lokasi"})]}):t?e.jsxs("div",{className:"bg-green-300/10 p-4 rounded-lg border border-green-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-green-700 text-sm font-medium",children:"Lokasi Terdeteksi"})]}),e.jsx("p",{className:"text-green-600 text-xs mt-1",children:t.address})]}):r?e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:e.jsx("p",{className:"text-yellow-700 text-sm",children:"Mendapatkan lokasi..."})}):null}function ta({onStartCamera:a}){return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"size-10 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-medium text-muted-foreground mb-2",children:"Mulai Dokumentasi"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Klik tombol di bawah untuk mengaktifkan kamera dan GPS"}),e.jsx(k,{onClick:a,className:"w-full sm:w-auto",children:"Mulai Kamera"})]})}function ra({videoRef:a,canvasRef:t,isLoading:r,hasLocation:c,isMobile:u,currentLocation:n,onStopCamera:s,onCapturePhoto:d,onFlipCamera:l}){return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"relative w-full",style:{aspectRatio:"16/9"},children:[e.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover rounded-lg border"}),n&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 bg-black/50 text-white rounded-b-lg",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm line-clamp-2 font-medium",children:n.address}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[e.jsx(I,{className:"h-3 w-3"}),e.jsxs("span",{children:[n.latitude.toFixed(6),", ",n.longitude.toFixed(6)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[e.jsx(Ue,{className:"h-3 w-3"}),e.jsx("span",{children:ne(new Date().toISOString())})]})]})})]}),e.jsx("canvas",{ref:t,className:"hidden"}),e.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[e.jsx(k,{variant:"outline",onClick:s,disabled:r,children:"Batal"}),u&&e.jsx(k,{variant:"outline",onClick:l,disabled:r,size:"icon",children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx(k,{onClick:d,disabled:r||!c,children:r?"Menyimpan...":"Ambil Foto"})]})]})})}function na({documentations:a,assignment:t,onShowLocation:r,onDownload:c,onDelete:u}){return a.length===0?e.jsxs(b,{className:"h-min",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Dokumentasi Lokasi"}),e.jsx(P,{children:"Belum ada dokumentasi lokasi yang diambil"})]}),e.jsx(_,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(I,{className:"size-10 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground ",children:"Mulai ambil foto untuk dokumentasi lokasi. Ambil 2 atau 4 foto agar rapi di laporan perjalanan."})]})})]}):e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsx(w,{children:"Dokumentasi Lokasi"}),e.jsxs(P,{children:[a.length," foto dokumentasi lokasi"]})]}),e.jsx(_,{children:e.jsx("div",{className:"space-y-4",children:a.map(n=>e.jsxs(b,{className:"p-0 shadow-none relative overflow-hidden",children:[n.photo?e.jsx("img",{src:n.photo,alt:"Dokumentasi lokasi",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:e.jsx(I,{className:"h-8 w-8"})}),t.report?.status!=="approved"&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(Fe,{onShow:()=>r(n),onDownload:()=>c(n),onDelete:()=>u(n),className:"bg-background/90 hover:bg-background"})})]},n.id))})})]})}function ia({assignment:a,documentations:t}){const[r,c]=j.useState(t||[]),[u,n]=j.useState(!1),[s,d]=j.useState(null),[l,m]=j.useState(!1),{currentLocation:h,locationError:f,getCurrentLocation:o,clearLocation:i}=Xe(),{isCapturing:p,videoRef:x,canvasRef:v,startCamera:S,stopCamera:R,capturePhoto:le,flipCamera:oe,isMobile:ce}=Ze(),{isLoading:de,uploadDocumentation:me}=ea(),{delete:ue,processing:he}=se(),{props:xe}=K(),E=xe.flash;j.useEffect(()=>{E?.success&&N.success(E.success),E?.error&&N.error(E.error)},[E]),j.useEffect(()=>{c(t||[])},[t]);const pe=async()=>{try{m(!0),await o(),await S()}catch(g){console.error("Error starting camera:",g),g instanceof Error&&(g.message.includes("lokasi")||N.error("Tidak dapat mengakses kamera"))}finally{m(!1)}},V=()=>{R(),i()},je=async()=>{if(!h){N.error("Lokasi tidak tersedia");return}try{const g=await le(h);g&&(await me(g,h,a.id,"assignment"),V())}catch(g){console.error("Error capturing photo:",g),N.error("Gagal mengambil foto")}},fe=async()=>{try{await oe()}catch(g){console.error("Error flipping camera:",g),N.error("Tidak dapat membalik kamera")}},ge=g=>{const ke=Number(g.latitude),ye=Number(g.longitude),we=`https://www.google.com/maps?q=${ke},${ye}`;window.open(we,"_blank")},Ne=async g=>{await aa(g.photo,g)},ve=g=>{d(g),n(!0)},be=()=>{s&&ue(route("assignments.documentation.destroy",[a.id,s.id]),{onBefore:()=>{N.loading("Sedang memproses...")},onSuccess:()=>{n(!1),d(null),N.dismiss()},onError:()=>{n(!1),d(null),N.dismiss()}})};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Be,{open:u,onOpenChange:n,onDelete:be,title:"Hapus dokumentasi?",description:"Tindakan ini tidak dapat dibatalkan. Dokumentasi ini akan dihapus secara permanen dari sistem.",actionLabel:"Hapus",cancelLabel:"Batal",disabled:he}),e.jsxs(b,{className:"h-min",children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Dokumentasi Lokasi"]}),e.jsx(P,{children:"Ambil foto 2 atau 4 foto dan catat lokasi untuk dokumentasi penugasan perjalanan dinas."})]}),e.jsx(_,{className:"space-y-4",children:p?e.jsxs("div",{className:"space-y-4",children:[e.jsx(sa,{locationError:f,currentLocation:h,isGettingLocation:l}),e.jsx(ra,{videoRef:x,canvasRef:v,isLoading:de,hasLocation:!!h,isMobile:ce,currentLocation:h,onStopCamera:V,onCapturePhoto:je,onFlipCamera:fe})]}):e.jsx(ta,{onStartCamera:pe})})]}),e.jsx(na,{documentations:r,assignment:a,onShowLocation:ge,onDownload:Ne,onDelete:ve})]})}function la({assignment:a,transportation_types:t}){const{data:r,setData:c,post:u,processing:n,errors:s}=se({assignment_id:a.id,travel_type:"",actual_duration:"",transportation_type_ids:[],travel_order_number:"",travel_order_file:null,spd_file:null}),d=(i,p)=>{if(p){if(!r.transportation_type_ids.includes(i)){const x=[...r.transportation_type_ids,i];c("transportation_type_ids",x)}}else{const x=r.transportation_type_ids.filter(v=>v!==i);c("transportation_type_ids",x)}},l=i=>{i.preventDefault();const p=new Promise((x,v)=>{u(route("reports.store"),{onSuccess:()=>{x({name:"Laporan"})},onError:S=>{v(S?.error||"Laporan gagal dibuat!")}})});N.promise(p,{loading:"Memproses..",success:x=>`${x.name} berhasil dibuat.`,error:x=>String(x)})},m=(i,p)=>{c(i,p)},h=()=>{c({assignment_id:a.id,travel_type:"",actual_duration:"",transportation_type_ids:[],travel_order_number:"",travel_order_file:null,spd_file:null})},f=a.report,o=a.report;return e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:f?e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5 text-green-600"}),"Laporan Sudah Dibuat"]}),e.jsx(P,{children:"Laporan perjalanan dinas untuk penugasan ini sudah dibuat"})]}),e.jsxs(_,{className:"space-y-4",children:[o&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Nomor Surat Tugas:"}),e.jsx("span",{className:"font-medium",children:o.travel_order_number||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Jenis Perjalanan:"}),e.jsx("span",{className:"font-medium",children:o.travel_type==="in_city"?"Dalam Kota":o.travel_type==="out_city"?"Luar Kota":o.travel_type==="out_country"?"Luar Negeri":"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx("span",{className:"font-medium capitalize-first",children:o.status||"Draft"})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(te,{href:route("reports.show",o?.id),children:e.jsxs(k,{className:"inline-flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Lihat Laporan"]})})})]})]}):e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Form Laporan Perjalanan"]}),e.jsx(P,{children:"Buat laporan pertanggung jawaban perjalanan dinas"})]}),e.jsx(_,{children:e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"travel_type",children:"Tipe Perjalanan"}),e.jsxs(Oe,{value:r.travel_type,onValueChange:i=>c("travel_type",i),children:[e.jsx($e,{children:e.jsx(He,{placeholder:"Pilih tipe perjalanan"})}),e.jsxs(ze,{children:[e.jsx(H,{value:"in_city",children:"Dalam Kota"}),e.jsx(H,{value:"out_city",children:"Luar Kota"}),e.jsx(H,{value:"out_country",children:"Luar Negeri"})]})]}),e.jsx(M,{message:s.travel_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"transportation_type_ids",children:"Jenis Transportasi"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:t&&Array.isArray(t)&&t.length>0?t.map(i=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ke,{id:`transportation_${i.id}`,checked:r.transportation_type_ids.includes(i.id),onCheckedChange:p=>d(i.id,p)}),e.jsx(T,{htmlFor:`transportation_${i.id}`,className:"text-sm font-normal cursor-pointer",children:i.label})]},i.id)):e.jsx("div",{className:"col-span-3",children:e.jsx("p",{className:"text-sm text-gray-500",children:t?"Tidak ada jenis transportasi tersedia":"Memuat jenis transportasi..."})})}),e.jsx(M,{message:s.transportation_type_ids}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pilih minimal satu jenis transportasi yang digunakan (wajib)"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"space-y-2 w-full md:w-3/4",children:[e.jsx(T,{htmlFor:"travel_order_number",children:"Nomor Surat Tugas"}),e.jsx(G,{id:"travel_order_number",value:r.travel_order_number,onChange:i=>c("travel_order_number",i.target.value),placeholder:"Masukkan nomor surat tugas"}),e.jsx(M,{message:s.travel_order_number})]}),e.jsxs("div",{className:"space-y-2 w-full md:w-1/4",children:[e.jsx(T,{htmlFor:"actual_duration",children:"Durasi Asli Perjalanan"}),e.jsx(G,{id:"actual_duration",type:"number",min:1,value:r.actual_duration,onChange:i=>c("actual_duration",i.target.value),placeholder:"Durasi asli perjalanan"}),e.jsx(M,{message:s.actual_duration})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"travel_order_file",children:"File Surat Tugas"}),e.jsx(ee,{value:r.travel_order_file,onChange:i=>m("travel_order_file",i),accept:".pdf,.doc,.docx",maxSize:2,placeholder:"Seret dan letakkan file di sini atau "}),e.jsx(M,{message:s.travel_order_file})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"spd_file",children:"File SPD (Surat Perintah Dinas)"}),e.jsx(ee,{value:r.spd_file,onChange:i=>m("spd_file",i),accept:".pdf,.doc,.docx",maxSize:2,placeholder:"Seret dan letakkan file di sini atau "}),e.jsx(M,{message:s.spd_file})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{type:"button",variant:"outline",onClick:h,children:"Reset"}),e.jsx(k,{type:"submit",disabled:n,children:n?"Menyimpan...":"Simpan Laporan"})]})]})})]})}),e.jsx("div",{className:"lg:col-span-1",children:f?e.jsxs(b,{children:[e.jsx(y,{children:e.jsx(w,{children:"Status Laporan"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx("p",{children:"Laporan perjalanan dinas sudah dibuat dan siap untuk ditinjau."})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Langkah Selanjutnya:"}),e.jsxs("ul",{className:"space-y-1 text-muted-foreground",children:[e.jsx("li",{children:'â€¢ Klik "Lihat Laporan" untuk melihat detail'}),e.jsx("li",{children:"â€¢ Laporan akan ditinjau oleh PPK"}),e.jsx("li",{children:"â€¢ Setelah disetujui PPK, akan ditinjau Pimpinan"})]})]})]})]}):e.jsxs(b,{children:[e.jsx(y,{children:e.jsx(w,{children:"Informasi"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx("p",{children:"Pastikan semua informasi yang dimasukkan sudah benar dan lengkap."})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("h4",{className:"font-medium mb-2",children:"File yang Diperlukan:"}),e.jsxs("ul",{className:"space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"â€¢ Surat Tugas (PDF/DOC)"}),e.jsx("li",{children:"â€¢ SPD - Surat Perintah Dinas (PDF/DOC)"})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Ukuran Maksimal:"}),e.jsx("p",{className:"text-muted-foreground",children:"2MB per file"})]})]})]})})]})}const z=[{title:"Dashboard",href:"/dashboard"},{title:"Penugasan",href:"/assignments"},{title:"Rincian",href:""}];function Ka({assignment:a,transportation_types:t}){const{auth:r}=K().props,[c,u]=j.useState(!1);if(j.useEffect(()=>(u(!0),()=>u(!1)),[]),!a||!r?.user)return e.jsxs(B,{breadcrumbs:z,children:[e.jsx(F,{title:"Rincian Penugasan"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx(U,{title:"Rincian Penugasan",subtitle:"Informasi lengkap penugasan perjalanan dinas"}),e.jsx("div",{className:"p-4 text-center",children:e.jsx("p",{className:"text-destructive",children:"Data tidak tersedia"})})]})]});const n=(r.user.roles??[]).some(x=>x.toLowerCase()==="employee"),s=new Date(a.start_date),l=new Date<s,{props:m}=K(),h=m?.flash?.tabs,[f,o]=j.useState(h||"details"),i=new Set(["documentation","create-report"]),p=x=>{if(c){if(n&&l&&i.has(x)){N.warning("Fitur ini baru bisa diakses saat penugasan sudah dimulai.");return}if(x==="create-report"&&(!a.assignmentDocumentations||a.assignmentDocumentations.length===0)){N.warning("Dokumentasi masih kosong. Silakan tambahkan dokumentasi terlebih dahulu.");return}o(x),W.get(route("assignments.show",a.id),{tabs:x},{preserveState:!0,preserveScroll:!0,replace:!0})}};return c?e.jsxs(B,{breadcrumbs:z,children:[e.jsx(F,{title:"Rincian Penugasan"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx(U,{title:"Rincian Penugasan",subtitle:"Informasi lengkap penugasan perjalanan dinas"}),e.jsx(k,{variant:"outline",asChild:!0,className:"ml-4",children:e.jsxs(te,{href:route("assignments.index"),children:[e.jsx(We,{className:"h-4 w-4"}),"Kembali"]})})]}),n?e.jsxs(Le,{value:f,onValueChange:p,className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-3",children:[e.jsxs(O,{value:"details",className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:block",children:"Rincian"})]}),e.jsxs(O,{value:"documentation",className:"flex items-center gap-2",disabled:l,title:l?"Dokumentasi bisa diakses saat penugasan sudah dimulai":void 0,children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:block",children:"Dokumentasi"})]}),e.jsxs(O,{value:"create-report",className:"flex items-center gap-2",disabled:l||!a.assignmentDocumentations||a.assignmentDocumentations.length===0,title:l?"Surat Tugas bisa diakses saat penugasan sudah dimulai":!a.assignmentDocumentations||a.assignmentDocumentations.length===0?"Dokumentasi masih kosong":void 0,children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:block",children:"Surat Tugas"})]})]}),e.jsx($,{value:"details",className:"space-y-4",children:e.jsx(ae,{assignment:a})}),e.jsx($,{value:"documentation",className:"space-y-4",children:e.jsx(ia,{assignment:a,documentations:a.assignmentDocumentations||[]})}),e.jsx($,{value:"create-report",className:"space-y-4",children:e.jsx(la,{assignment:a,transportation_types:t})})]}):e.jsx("div",{className:"space-y-4",children:e.jsx(ae,{assignment:a})})]})]}):e.jsxs(B,{breadcrumbs:z,children:[e.jsx(F,{title:"Rincian Penugasan"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx(U,{title:"Rincian Penugasan",subtitle:"Informasi lengkap penugasan perjalanan dinas"}),e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Memuat data..."})]})})]})]})}export{Ka as default};
